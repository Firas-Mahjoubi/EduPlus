{% extends 'base.html.twig' %}

{% block title %}Liste des Ressources{% endblock %}

{% block body %}
<!-- Blog Start -->
<div class="container-fluid py-5 wow fadeInUp" data-wow-delay="0.1s">
    <div class="container py-5">
        <div class="row g-5">
            
            <!-- Search Form Start -->
            <div class="mb-5 wow slideInUp" data-wow-delay="0.1s">
                <div class="input-group">
                    <input type="text" id="search-input" class="form-control p-3" placeholder="Search by keyword..." aria-label="Search">
                    <button class="btn btn-primary px-4"><i class="bi bi-search"></i></button>
                </div>
            </div>
            <!-- Search Form End -->
            
            <!-- Blog List Start -->
            <div class="col-lg-8" id="ressources-list">
                <div class="row g-5" id="resources-container">
                    {% for ressource in ressources %}
                        <div class="col-md-6 wow slideInUp" data-wow-delay="{{ loop.index * 0.1 }}s">
                            <div class="blog-item bg-light rounded shadow-sm overflow-hidden">
                                <div class="blog-img position-relative overflow-hidden">
                                    <img class="img-fluid" src="{{ asset('uploads/ressources/' ~ ressource.image) }}" alt="{{ ressource.nomRessource }}" style="width: 100%; height: 200px; object-fit: cover;">
                                    <a class="position-absolute top-0 start-0 bg-primary text-white rounded-end mt-5 py-2 px-4" href="#">{{ ressource.nomRessource }}</a>
                                </div>
                                <div class="p-4">
                                    <div class="d-flex mb-3">
                                        <small class="me-3 text-muted"><i class="far fa-user text-primary me-2"></i> {{ ressource.nomRessource }}</small>
                                        <small class="text-muted"><i class="far fa-calendar-alt text-primary me-2"></i>{{ ressource.dateCreationRessource|date('d M, Y') }}</small>
                                    </div>
                                    <h4 class="mb-3">{{ ressource.nomRessource }}</h4>
                                    <p>{{ ressource.descriptionRessource }}</p>
                                    <a class="text-uppercase text-primary" href="{{ path('demande_ressource', { 'ressourceId': ressource.id }) }}">
                                        faire une demande <i class="bi bi-arrow-right"></i>
                                    </a>
                                                                 
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <p>Aucune ressource trouvée.</p>
                    {% endfor %}
                </div>
            </div>
            <!-- Blog List End -->

        </div>
    </div>
</div>
<!-- Blog End -->
{% endblock %}
{% block javascripts %}
    <script>
        // JavaScript to trigger AJAX search
        document.getElementById('search-input').addEventListener('input', function() {
            var searchTerm = this.value;

            // Make the AJAX request
            fetch("{{ path('search_resources_ajax') }}?search=" + encodeURIComponent(searchTerm))
                .then(response => response.json())
                .then(data => {
                    var resourcesContainer = document.getElementById('resources-container');
                    resourcesContainer.innerHTML = '';

                    if (data.ressources.length > 0) {
                        // Iterate through the resources and render them
                        data.ressources.forEach(function(ressource) {
                            var ressourceHtml = `
                                <div class="col-md-6 wow slideInUp">
                                    <div class="blog-item bg-light rounded shadow-sm overflow-hidden">
                                        <div class="blog-img position-relative overflow-hidden">
                                            <img class="img-fluid" src="/uploads/ressources/${ressource.image}" alt="${ressource.nomRessource}" style="width: 100%; height: 200px; object-fit: cover;">
                                            <a class="position-absolute top-0 start-0 bg-primary text-white rounded-end mt-5 py-2 px-4" href="#">${ressource.nomRessource}</a>
                                        </div>
                                        <div class="p-4">
                                            <div class="d-flex mb-3">
                                                <small class="me-3 text-muted"><i class="far fa-user text-primary me-2"></i> ${ressource.nomRessource}</small>
                                                <small class="text-muted"><i class="far fa-calendar-alt text-primary me-2"></i>${ressource.dateCreationRessource}</small>
                                            </div>
                                            <h4 class="mb-3">${ressource.nomRessource}</h4>
                                            <p>${ressource.descriptionRessource}</p>
                                            <a class="text-uppercase text-primary" href="${ressource.nomRessource}">Lire la suite <i class="bi bi-arrow-right"></i></a>
                                        </div>
                                    </div>
                                </div>
                            `;
                            resourcesContainer.innerHTML += ressourceHtml;
                        });
                    } else {
                        resourcesContainer.innerHTML = '<p>Aucune ressource trouvée.</p>';
                    }
                })
                .catch(error => console.error('Error fetching resources:', error));
        });
    </script>
{% endblock %}
